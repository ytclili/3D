/* eslint-disable */
export const GLTFLoader=function(){function GLTFLoader(manager){THREE.Loader.call(this,manager),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(parser){return new GLTFMaterialsClearcoatExtension(parser)})),this.register((function(parser){return new GLTFTextureBasisUExtension(parser)})),this.register((function(parser){return new GLTFTextureWebPExtension(parser)})),this.register((function(parser){return new GLTFMaterialsTransmissionExtension(parser)})),this.register((function(parser){return new GLTFLightsExtension(parser)})),this.register((function(parser){return new GLTFMeshoptCompression(parser)}))}function GLTFRegistry(){var objects={};return{get:function(key){return objects[key]},add:function(key,object){objects[key]=object},remove:function(key){delete objects[key]},removeAll:function(){objects={}}}}GLTFLoader.prototype=Object.assign(Object.create(THREE.Loader.prototype),{constructor:GLTFLoader,load:function(url,onLoad,onProgress,onError){var scope=this,resourcePath;resourcePath=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(url),this.manager.itemStart(url);var _onError=function(e){onError?onError(e):console.error(e),scope.manager.itemError(url),scope.manager.itemEnd(url)},loader=new THREE.FileLoader(this.manager);loader.setPath(this.path),loader.setResponseType("arraybuffer"),loader.setRequestHeader(this.requestHeader),loader.setWithCredentials(this.withCredentials),loader.load(url,(function(data){try{scope.parse(data,resourcePath,(function(gltf){onLoad(gltf),scope.manager.itemEnd(url)}),_onError)}catch(e){_onError(e)}}),onProgress,_onError)},setDRACOLoader:function(dracoLoader){return this.dracoLoader=dracoLoader,this},setDDSLoader:function(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')},setKTX2Loader:function(ktx2Loader){return this.ktx2Loader=ktx2Loader,this},setMeshoptDecoder:function(meshoptDecoder){return this.meshoptDecoder=meshoptDecoder,this},register:function(callback){return-1===this.pluginCallbacks.indexOf(callback)&&this.pluginCallbacks.push(callback),this},unregister:function(callback){return-1!==this.pluginCallbacks.indexOf(callback)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(callback),1),this},parse:function(data,path,onLoad,onError){var content,extensions={},plugins={},magic;if("string"==typeof data)content=data;else if(THREE.LoaderUtils.decodeText(new Uint8Array(data,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{extensions[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(data)}catch(error){return void(onError&&onError(error))}content=extensions[EXTENSIONS.KHR_BINARY_GLTF].content}else content=THREE.LoaderUtils.decodeText(new Uint8Array(data));var json=JSON.parse(content);if(void 0===json.asset||json.asset.version[0]<2)onError&&onError(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var parser=new GLTFParser(json,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});parser.fileLoader.setRequestHeader(this.requestHeader);for(var i=0;i<this.pluginCallbacks.length;i++){var plugin=this.pluginCallbacks[i](parser);plugins[plugin.name]=plugin,extensions[plugin.name]=!0}if(json.extensionsUsed)for(var i=0;i<json.extensionsUsed.length;++i){var extensionName=json.extensionsUsed[i],extensionsRequired=json.extensionsRequired||[];switch(extensionName){case EXTENSIONS.KHR_MATERIALS_UNLIT:extensions[extensionName]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:extensions[extensionName]=new GLTFMaterialsPbrSpecularGlossinessExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:extensions[extensionName]=new GLTFDracoMeshCompressionExtension(json,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:extensions[extensionName]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:extensions[extensionName]=new GLTFMeshQuantizationExtension;break;default:extensionsRequired.indexOf(extensionName)>=0&&void 0===plugins[extensionName]&&console.warn('THREE.GLTFLoader: Unknown extension "'+extensionName+'".')}}parser.setExtensions(extensions),parser.setPlugins(plugins),parser.parse(onLoad,onError)}}});var EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};function GLTFLightsExtension(parser){this.parser=parser,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function GLTFMaterialsUnlitExtension(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}function GLTFMaterialsClearcoatExtension(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}function GLTFMaterialsTransmissionExtension(parser){this.parser=parser,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}function GLTFTextureBasisUExtension(parser){this.parser=parser,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}function GLTFTextureWebPExtension(parser){this.parser=parser,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}function GLTFMeshoptCompression(parser){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=parser}GLTFLightsExtension.prototype._markDefs=function(){for(var parser=this.parser,nodeDefs=this.parser.json.nodes||[],nodeIndex=0,nodeLength=nodeDefs.length;nodeIndex<nodeLength;nodeIndex++){var nodeDef=nodeDefs[nodeIndex];nodeDef.extensions&&nodeDef.extensions[this.name]&&void 0!==nodeDef.extensions[this.name].light&&parser._addNodeRef(this.cache,nodeDef.extensions[this.name].light)}},GLTFLightsExtension.prototype._loadLight=function(lightIndex){var parser=this.parser,cacheKey="light:"+lightIndex,dependency=parser.cache.get(cacheKey);if(dependency)return dependency;var json=parser.json,extensions,lightDefs,lightDef=((json.extensions&&json.extensions[this.name]||{}).lights||[])[lightIndex],lightNode,color=new THREE.Color(16777215);void 0!==lightDef.color&&color.fromArray(lightDef.color);var range=void 0!==lightDef.range?lightDef.range:0;switch(lightDef.type){case"directional":(lightNode=new THREE.DirectionalLight(color)).target.position.set(0,0,-1),lightNode.add(lightNode.target);break;case"point":(lightNode=new THREE.PointLight(color)).distance=range;break;case"spot":(lightNode=new THREE.SpotLight(color)).distance=range,lightDef.spot=lightDef.spot||{},lightDef.spot.innerConeAngle=void 0!==lightDef.spot.innerConeAngle?lightDef.spot.innerConeAngle:0,lightDef.spot.outerConeAngle=void 0!==lightDef.spot.outerConeAngle?lightDef.spot.outerConeAngle:Math.PI/4,lightNode.angle=lightDef.spot.outerConeAngle,lightNode.penumbra=1-lightDef.spot.innerConeAngle/lightDef.spot.outerConeAngle,lightNode.target.position.set(0,0,-1),lightNode.add(lightNode.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+lightDef.type)}return lightNode.position.set(0,0,0),lightNode.decay=2,void 0!==lightDef.intensity&&(lightNode.intensity=lightDef.intensity),lightNode.name=parser.createUniqueName(lightDef.name||"light_"+lightIndex),dependency=Promise.resolve(lightNode),parser.cache.add(cacheKey,dependency),dependency},GLTFLightsExtension.prototype.createNodeAttachment=function(nodeIndex){var self=this,parser=this.parser,json,nodeDef=parser.json.nodes[nodeIndex],lightDef,lightIndex=(nodeDef.extensions&&nodeDef.extensions[this.name]||{}).light;return void 0===lightIndex?null:this._loadLight(lightIndex).then((function(light){return parser._getNodeRef(self.cache,lightIndex,light)}))},GLTFMaterialsUnlitExtension.prototype.getMaterialType=function(){return THREE.MeshBasicMaterial},GLTFMaterialsUnlitExtension.prototype.extendParams=function(materialParams,materialDef,parser){var pending=[];materialParams.color=new THREE.Color(1,1,1),materialParams.opacity=1;var metallicRoughness=materialDef.pbrMetallicRoughness;if(metallicRoughness){if(Array.isArray(metallicRoughness.baseColorFactor)){var array=metallicRoughness.baseColorFactor;materialParams.color.fromArray(array),materialParams.opacity=array[3]}void 0!==metallicRoughness.baseColorTexture&&pending.push(parser.assignTexture(materialParams,"map",metallicRoughness.baseColorTexture))}return Promise.all(pending)},GLTFMaterialsClearcoatExtension.prototype.getMaterialType=function(materialIndex){var parser,materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?THREE.MeshPhysicalMaterial:null},GLTFMaterialsClearcoatExtension.prototype.extendMaterialParams=function(materialIndex,materialParams){var parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();var pending=[],extension=materialDef.extensions[this.name];if(void 0!==extension.clearcoatFactor&&(materialParams.clearcoat=extension.clearcoatFactor),void 0!==extension.clearcoatTexture&&pending.push(parser.assignTexture(materialParams,"clearcoatMap",extension.clearcoatTexture)),void 0!==extension.clearcoatRoughnessFactor&&(materialParams.clearcoatRoughness=extension.clearcoatRoughnessFactor),void 0!==extension.clearcoatRoughnessTexture&&pending.push(parser.assignTexture(materialParams,"clearcoatRoughnessMap",extension.clearcoatRoughnessTexture)),void 0!==extension.clearcoatNormalTexture&&(pending.push(parser.assignTexture(materialParams,"clearcoatNormalMap",extension.clearcoatNormalTexture)),void 0!==extension.clearcoatNormalTexture.scale)){var scale=extension.clearcoatNormalTexture.scale;materialParams.clearcoatNormalScale=new THREE.Vector2(scale,-scale)}return Promise.all(pending)},GLTFMaterialsTransmissionExtension.prototype.getMaterialType=function(materialIndex){var parser,materialDef=this.parser.json.materials[materialIndex];return materialDef.extensions&&materialDef.extensions[this.name]?THREE.MeshPhysicalMaterial:null},GLTFMaterialsTransmissionExtension.prototype.extendMaterialParams=function(materialIndex,materialParams){var parser=this.parser,materialDef=parser.json.materials[materialIndex];if(!materialDef.extensions||!materialDef.extensions[this.name])return Promise.resolve();var pending=[],extension=materialDef.extensions[this.name];return void 0!==extension.transmissionFactor&&(materialParams.transmission=extension.transmissionFactor),void 0!==extension.transmissionTexture&&pending.push(parser.assignTexture(materialParams,"transmissionMap",extension.transmissionTexture)),Promise.all(pending)},GLTFTextureBasisUExtension.prototype.loadTexture=function(textureIndex){var parser=this.parser,json=parser.json,textureDef=json.textures[textureIndex];if(!textureDef.extensions||!textureDef.extensions[this.name])return null;var extension=textureDef.extensions[this.name],source=json.images[extension.source],loader=parser.options.ktx2Loader;if(!loader){if(json.extensionsRequired&&json.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return parser.loadTextureImage(textureIndex,source,loader)},GLTFTextureWebPExtension.prototype.loadTexture=function(textureIndex){var name=this.name,parser=this.parser,json=parser.json,textureDef=json.textures[textureIndex];if(!textureDef.extensions||!textureDef.extensions[name])return null;var extension=textureDef.extensions[name],source=json.images[extension.source],loader=parser.textureLoader;if(source.uri){var handler=parser.options.manager.getHandler(source.uri);null!==handler&&(loader=handler)}return this.detectSupport().then((function(isSupported){if(isSupported)return parser.loadTextureImage(textureIndex,source,loader);if(json.extensionsRequired&&json.extensionsRequired.indexOf(name)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return parser.loadTexture(textureIndex)}))},GLTFTextureWebPExtension.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(resolve){var image=new Image;image.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",image.onload=image.onerror=function(){resolve(1===image.height)}}))),this.isSupported},GLTFMeshoptCompression.prototype.loadBufferView=function(index){var json=this.parser.json,bufferView=json.bufferViews[index];if(bufferView.extensions&&bufferView.extensions[this.name]){var extensionDef=bufferView.extensions[this.name],buffer=this.parser.getDependency("buffer",extensionDef.buffer),decoder=this.parser.options.meshoptDecoder;if(!decoder||!decoder.supported){if(json.extensionsRequired&&json.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([buffer,decoder.ready]).then((function(res){var byteOffset=extensionDef.byteOffset||0,byteLength=extensionDef.byteLength||0,count=extensionDef.count,stride=extensionDef.byteStride,result=new ArrayBuffer(count*stride),source=new Uint8Array(res[0],byteOffset,byteLength);return decoder.decodeGltfBuffer(new Uint8Array(result),count,stride,source,extensionDef.mode,extensionDef.filter),result}))}return null};var BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES_JSON=1313821514,BINARY_EXTENSION_CHUNK_TYPES_BIN=5130562;function GLTFBinaryExtension(data){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;var headerView=new DataView(data,0,12);if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:headerView.getUint32(4,!0),length:headerView.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var chunkContentsLength=this.header.length-12,chunkView=new DataView(data,12),chunkIndex=0;chunkIndex<chunkContentsLength;){var chunkLength=chunkView.getUint32(chunkIndex,!0);chunkIndex+=4;var chunkType=chunkView.getUint32(chunkIndex,!0);if(chunkIndex+=4,chunkType===BINARY_EXTENSION_CHUNK_TYPES_JSON){var contentArray=new Uint8Array(data,12+chunkIndex,chunkLength);this.content=THREE.LoaderUtils.decodeText(contentArray)}else if(chunkType===BINARY_EXTENSION_CHUNK_TYPES_BIN){var byteOffset=12+chunkIndex;this.body=data.slice(byteOffset,byteOffset+chunkLength)}chunkIndex+=chunkLength}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function GLTFDracoMeshCompressionExtension(json,dracoLoader){if(!dracoLoader)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=json,this.dracoLoader=dracoLoader,this.dracoLoader.preload()}function GLTFTextureTransformExtension(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}function GLTFMeshStandardSGMaterial(params){THREE.MeshStandardMaterial.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var specularMapParsFragmentChunk=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),glossinessMapParsFragmentChunk=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),specularMapFragmentChunk=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),glossinessMapFragmentChunk=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),lightPhysicalFragmentChunk=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),uniforms={specular:{value:(new THREE.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=uniforms,this.onBeforeCompile=function(shader){for(var uniformName in uniforms)shader.uniforms[uniformName]=uniforms[uniformName];shader.fragmentShader=shader.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",specularMapParsFragmentChunk).replace("#include <metalnessmap_pars_fragment>",glossinessMapParsFragmentChunk).replace("#include <roughnessmap_fragment>",specularMapFragmentChunk).replace("#include <metalnessmap_fragment>",glossinessMapFragmentChunk).replace("#include <lights_physical_fragment>",lightPhysicalFragmentChunk)},Object.defineProperties(this,{specular:{get:function(){return uniforms.specular.value},set:function(v){uniforms.specular.value=v}},specularMap:{get:function(){return uniforms.specularMap.value},set:function(v){uniforms.specularMap.value=v,v?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return uniforms.glossiness.value},set:function(v){uniforms.glossiness.value=v}},glossinessMap:{get:function(){return uniforms.glossinessMap.value},set:function(v){uniforms.glossinessMap.value=v,v?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(params)}function GLTFMaterialsPbrSpecularGlossinessExtension(){return{name:EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return GLTFMeshStandardSGMaterial},extendParams:function(materialParams,materialDef,parser){var pbrSpecularGlossiness=materialDef.extensions[this.name];materialParams.color=new THREE.Color(1,1,1),materialParams.opacity=1;var pending=[];if(Array.isArray(pbrSpecularGlossiness.diffuseFactor)){var array=pbrSpecularGlossiness.diffuseFactor;materialParams.color.fromArray(array),materialParams.opacity=array[3]}if(void 0!==pbrSpecularGlossiness.diffuseTexture&&pending.push(parser.assignTexture(materialParams,"map",pbrSpecularGlossiness.diffuseTexture)),materialParams.emissive=new THREE.Color(0,0,0),materialParams.glossiness=void 0!==pbrSpecularGlossiness.glossinessFactor?pbrSpecularGlossiness.glossinessFactor:1,materialParams.specular=new THREE.Color(1,1,1),Array.isArray(pbrSpecularGlossiness.specularFactor)&&materialParams.specular.fromArray(pbrSpecularGlossiness.specularFactor),void 0!==pbrSpecularGlossiness.specularGlossinessTexture){var specGlossMapDef=pbrSpecularGlossiness.specularGlossinessTexture;pending.push(parser.assignTexture(materialParams,"glossinessMap",specGlossMapDef)),pending.push(parser.assignTexture(materialParams,"specularMap",specGlossMapDef))}return Promise.all(pending)},createMaterial:function(materialParams){var material=new GLTFMeshStandardSGMaterial(materialParams);return material.fog=!0,material.color=materialParams.color,material.map=void 0===materialParams.map?null:materialParams.map,material.lightMap=null,material.lightMapIntensity=1,material.aoMap=void 0===materialParams.aoMap?null:materialParams.aoMap,material.aoMapIntensity=1,material.emissive=materialParams.emissive,material.emissiveIntensity=1,material.emissiveMap=void 0===materialParams.emissiveMap?null:materialParams.emissiveMap,material.bumpMap=void 0===materialParams.bumpMap?null:materialParams.bumpMap,material.bumpScale=1,material.normalMap=void 0===materialParams.normalMap?null:materialParams.normalMap,material.normalMapType=THREE.TangentSpaceNormalMap,materialParams.normalScale&&(material.normalScale=materialParams.normalScale),material.displacementMap=null,material.displacementScale=1,material.displacementBias=0,material.specularMap=void 0===materialParams.specularMap?null:materialParams.specularMap,material.specular=materialParams.specular,material.glossinessMap=void 0===materialParams.glossinessMap?null:materialParams.glossinessMap,material.glossiness=materialParams.glossiness,material.alphaMap=null,material.envMap=void 0===materialParams.envMap?null:materialParams.envMap,material.envMapIntensity=1,material.refractionRatio=.98,material}}}function GLTFMeshQuantizationExtension(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}function GLTFCubicSplineInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){THREE.Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}GLTFDracoMeshCompressionExtension.prototype.decodePrimitive=function(primitive,parser){var json=this.json,dracoLoader=this.dracoLoader,bufferViewIndex=primitive.extensions[this.name].bufferView,gltfAttributeMap=primitive.extensions[this.name].attributes,threeAttributeMap={},attributeNormalizedMap={},attributeTypeMap={};for(var attributeName in gltfAttributeMap){var threeAttributeName=ATTRIBUTES[attributeName]||attributeName.toLowerCase();threeAttributeMap[threeAttributeName]=gltfAttributeMap[attributeName]}for(attributeName in primitive.attributes){var threeAttributeName=ATTRIBUTES[attributeName]||attributeName.toLowerCase();if(void 0!==gltfAttributeMap[attributeName]){var accessorDef=json.accessors[primitive.attributes[attributeName]],componentType=WEBGL_COMPONENT_TYPES[accessorDef.componentType];attributeTypeMap[threeAttributeName]=componentType,attributeNormalizedMap[threeAttributeName]=!0===accessorDef.normalized}}return parser.getDependency("bufferView",bufferViewIndex).then((function(bufferView){return new Promise((function(resolve){dracoLoader.decodeDracoFile(bufferView,(function(geometry){for(var attributeName in geometry.attributes){var attribute=geometry.attributes[attributeName],normalized=attributeNormalizedMap[attributeName];void 0!==normalized&&(attribute.normalized=normalized)}resolve(geometry)}),threeAttributeMap,attributeTypeMap)}))}))},GLTFTextureTransformExtension.prototype.extendTexture=function(texture,transform){return texture=texture.clone(),void 0!==transform.offset&&texture.offset.fromArray(transform.offset),void 0!==transform.rotation&&(texture.rotation=transform.rotation),void 0!==transform.scale&&texture.repeat.fromArray(transform.scale),void 0!==transform.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),texture.needsUpdate=!0,texture},GLTFMeshStandardSGMaterial.prototype=Object.create(THREE.MeshStandardMaterial.prototype),GLTFMeshStandardSGMaterial.prototype.constructor=GLTFMeshStandardSGMaterial,GLTFMeshStandardSGMaterial.prototype.copy=function(source){return THREE.MeshStandardMaterial.prototype.copy.call(this,source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},GLTFCubicSplineInterpolant.prototype=Object.create(THREE.Interpolant.prototype),GLTFCubicSplineInterpolant.prototype.constructor=GLTFCubicSplineInterpolant,GLTFCubicSplineInterpolant.prototype.copySampleValue_=function(index){for(var result=this.resultBuffer,values=this.sampleValues,valueSize=this.valueSize,offset=index*valueSize*3+valueSize,i=0;i!==valueSize;i++)result[i]=values[offset+i];return result},GLTFCubicSplineInterpolant.prototype.beforeStart_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.afterEnd_=GLTFCubicSplineInterpolant.prototype.copySampleValue_,GLTFCubicSplineInterpolant.prototype.interpolate_=function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,stride2=2*stride,stride3=3*stride,td=t1-t0,p=(t-t0)/td,pp=p*p,ppp=pp*p,offset1=i1*stride3,offset0=offset1-stride3,s2=-2*ppp+3*pp,s3=ppp-pp,s0=1-s2,s1=s3-pp+p,i=0;i!==stride;i++){var p0=values[offset0+i+stride],m0=values[offset0+i+stride2]*td,p1=values[offset1+i+stride],m1=values[offset1+i]*td;result[i]=s0*p0+s1*m0+s2*p1+s3*m1}return result};var WEBGL_CONSTANTS_FLOAT=5126,WEBGL_CONSTANTS_FLOAT_MAT3=35675,WEBGL_CONSTANTS_FLOAT_MAT4=35676,WEBGL_CONSTANTS_FLOAT_VEC2=35664,WEBGL_CONSTANTS_FLOAT_VEC3=35665,WEBGL_CONSTANTS_FLOAT_VEC4=35666,WEBGL_CONSTANTS_LINEAR=9729,WEBGL_CONSTANTS_REPEAT=10497,WEBGL_CONSTANTS_SAMPLER_2D=35678,WEBGL_CONSTANTS_POINTS=0,WEBGL_CONSTANTS_LINES=1,WEBGL_CONSTANTS_LINE_LOOP=2,WEBGL_CONSTANTS_LINE_STRIP=3,WEBGL_CONSTANTS_TRIANGLES=4,WEBGL_CONSTANTS_TRIANGLE_STRIP=5,WEBGL_CONSTANTS_TRIANGLE_FAN=6,WEBGL_CONSTANTS_UNSIGNED_BYTE=5121,WEBGL_CONSTANTS_UNSIGNED_SHORT=5123,WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipmapNearestFilter,9985:THREE.LinearMipmapNearestFilter,9986:THREE.NearestMipmapLinearFilter,9987:THREE.LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},ALPHA_MODES_OPAQUE="OPAQUE",ALPHA_MODES_MASK="MASK",ALPHA_MODES_BLEND="BLEND";function resolveURL(url,path){return"string"!=typeof url||""===url?"":(/^https?:\/\//i.test(path)&&/^\//.test(url)&&(path=path.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(url)?url:/^data:.*,.*$/i.test(url)?url:/^blob:.*$/i.test(url)?url:path+url)}function createDefaultMaterial(cache){return void 0===cache.DefaultMaterial&&(cache.DefaultMaterial=new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})),cache.DefaultMaterial}function addUnknownExtensionsToUserData(knownExtensions,object,objectDef){for(var name in objectDef.extensions)void 0===knownExtensions[name]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[name]=objectDef.extensions[name])}function assignExtrasToUserData(object,gltfDef){void 0!==gltfDef.extras&&("object"==typeof gltfDef.extras?Object.assign(object.userData,gltfDef.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+gltfDef.extras))}function addMorphTargets(geometry,targets,parser){for(var hasMorphPosition=!1,hasMorphNormal=!1,i=0,il=targets.length;i<il;i++){var target;if(void 0!==(target=targets[i]).POSITION&&(hasMorphPosition=!0),void 0!==target.NORMAL&&(hasMorphNormal=!0),hasMorphPosition&&hasMorphNormal)break}if(!hasMorphPosition&&!hasMorphNormal)return Promise.resolve(geometry);for(var pendingPositionAccessors=[],pendingNormalAccessors=[],i=0,il=targets.length;i<il;i++){var target=targets[i];if(hasMorphPosition){var pendingAccessor=void 0!==target.POSITION?parser.getDependency("accessor",target.POSITION):geometry.attributes.position;pendingPositionAccessors.push(pendingAccessor)}if(hasMorphNormal){var pendingAccessor=void 0!==target.NORMAL?parser.getDependency("accessor",target.NORMAL):geometry.attributes.normal;pendingNormalAccessors.push(pendingAccessor)}}return Promise.all([Promise.all(pendingPositionAccessors),Promise.all(pendingNormalAccessors)]).then((function(accessors){var morphPositions=accessors[0],morphNormals=accessors[1];return hasMorphPosition&&(geometry.morphAttributes.position=morphPositions),hasMorphNormal&&(geometry.morphAttributes.normal=morphNormals),geometry.morphTargetsRelative=!0,geometry}))}function updateMorphTargets(mesh,meshDef){if(mesh.updateMorphTargets(),void 0!==meshDef.weights)for(var i=0,il=meshDef.weights.length;i<il;i++)mesh.morphTargetInfluences[i]=meshDef.weights[i];if(meshDef.extras&&Array.isArray(meshDef.extras.targetNames)){var targetNames=meshDef.extras.targetNames;if(mesh.morphTargetInfluences.length===targetNames.length){mesh.morphTargetDictionary={};for(var i=0,il=targetNames.length;i<il;i++)mesh.morphTargetDictionary[targetNames[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(primitiveDef){var dracoExtension=primitiveDef.extensions&&primitiveDef.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION],geometryKey;return geometryKey=dracoExtension?"draco:"+dracoExtension.bufferView+":"+dracoExtension.indices+":"+createAttributesKey(dracoExtension.attributes):primitiveDef.indices+":"+createAttributesKey(primitiveDef.attributes)+":"+primitiveDef.mode}function createAttributesKey(attributes){for(var attributesKey="",keys=Object.keys(attributes).sort(),i=0,il=keys.length;i<il;i++)attributesKey+=keys[i]+":"+attributes[keys[i]]+";";return attributesKey}function GLTFParser(json,options){this.json=json||{},this.extensions={},this.plugins={},this.options=options||{},this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new THREE.ImageBitmapLoader(this.options.manager):this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function computeBounds(geometry,primitiveDef,parser){var attributes=primitiveDef.attributes,box=new THREE.Box3;if(void 0!==attributes.POSITION){var accessor,min=(accessor=parser.json.accessors[attributes.POSITION]).min,max=accessor.max;if(void 0!==min&&void 0!==max){box.set(new THREE.Vector3(min[0],min[1],min[2]),new THREE.Vector3(max[0],max[1],max[2]));var targets=primitiveDef.targets;if(void 0!==targets){for(var maxDisplacement=new THREE.Vector3,vector=new THREE.Vector3,i=0,il=targets.length;i<il;i++){var target=targets[i];if(void 0!==target.POSITION){var accessor,min=(accessor=parser.json.accessors[target.POSITION]).min,max=accessor.max;void 0!==min&&void 0!==max?(vector.setX(Math.max(Math.abs(min[0]),Math.abs(max[0]))),vector.setY(Math.max(Math.abs(min[1]),Math.abs(max[1]))),vector.setZ(Math.max(Math.abs(min[2]),Math.abs(max[2]))),maxDisplacement.max(vector)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}box.expandByVector(maxDisplacement)}geometry.boundingBox=box;var sphere=new THREE.Sphere;box.getCenter(sphere.center),sphere.radius=box.min.distanceTo(box.max)/2,geometry.boundingSphere=sphere}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}function addPrimitiveAttributes(geometry,primitiveDef,parser){var attributes=primitiveDef.attributes,pending=[];function assignAttributeAccessor(accessorIndex,attributeName){return parser.getDependency("accessor",accessorIndex).then((function(accessor){geometry.setAttribute(attributeName,accessor)}))}for(var gltfAttributeName in attributes){var threeAttributeName=ATTRIBUTES[gltfAttributeName]||gltfAttributeName.toLowerCase();threeAttributeName in geometry.attributes||pending.push(assignAttributeAccessor(attributes[gltfAttributeName],threeAttributeName))}if(void 0!==primitiveDef.indices&&!geometry.index){var accessor=parser.getDependency("accessor",primitiveDef.indices).then((function(accessor){geometry.setIndex(accessor)}));pending.push(accessor)}return assignExtrasToUserData(geometry,primitiveDef),computeBounds(geometry,primitiveDef,parser),Promise.all(pending).then((function(){return void 0!==primitiveDef.targets?addMorphTargets(geometry,primitiveDef.targets,parser):geometry}))}function toTrianglesDrawMode(geometry,drawMode){var index=geometry.getIndex();if(null===index){var indices=[],position=geometry.getAttribute("position");if(void 0===position)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),geometry;for(var i=0;i<position.count;i++)indices.push(i);geometry.setIndex(indices),index=geometry.getIndex()}var numberOfTriangles=index.count-2,newIndices=[];if(drawMode===THREE.TriangleFanDrawMode)for(var i=1;i<=numberOfTriangles;i++)newIndices.push(index.getX(0)),newIndices.push(index.getX(i)),newIndices.push(index.getX(i+1));else for(var i=0;i<numberOfTriangles;i++)i%2==0?(newIndices.push(index.getX(i)),newIndices.push(index.getX(i+1)),newIndices.push(index.getX(i+2))):(newIndices.push(index.getX(i+2)),newIndices.push(index.getX(i+1)),newIndices.push(index.getX(i)));newIndices.length/3!==numberOfTriangles&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var newGeometry=geometry.clone();return newGeometry.setIndex(newIndices),newGeometry}return GLTFParser.prototype.setExtensions=function(extensions){this.extensions=extensions},GLTFParser.prototype.setPlugins=function(plugins){this.plugins=plugins},GLTFParser.prototype.parse=function(onLoad,onError){var parser=this,json=this.json,extensions=this.extensions;this.cache.removeAll(),this._invokeAll((function(ext){return ext._markDefs&&ext._markDefs()})),Promise.all(this._invokeAll((function(ext){return ext.beforeRoot&&ext.beforeRoot()}))).then((function(){return Promise.all([parser.getDependencies("scene"),parser.getDependencies("animation"),parser.getDependencies("camera")])})).then((function(dependencies){var result={scene:dependencies[0][json.scene||0],scenes:dependencies[0],animations:dependencies[1],cameras:dependencies[2],asset:json.asset,parser:parser,userData:{}};addUnknownExtensionsToUserData(extensions,result,json),assignExtrasToUserData(result,json),Promise.all(parser._invokeAll((function(ext){return ext.afterRoot&&ext.afterRoot(result)}))).then((function(){onLoad(result)}))})).catch(onError)},GLTFParser.prototype._markDefs=function(){for(var nodeDefs=this.json.nodes||[],skinDefs=this.json.skins||[],meshDefs=this.json.meshes||[],skinIndex=0,skinLength=skinDefs.length;skinIndex<skinLength;skinIndex++)for(var joints=skinDefs[skinIndex].joints,i=0,il=joints.length;i<il;i++)nodeDefs[joints[i]].isBone=!0;for(var nodeIndex=0,nodeLength=nodeDefs.length;nodeIndex<nodeLength;nodeIndex++){var nodeDef=nodeDefs[nodeIndex];void 0!==nodeDef.mesh&&(this._addNodeRef(this.meshCache,nodeDef.mesh),void 0!==nodeDef.skin&&(meshDefs[nodeDef.mesh].isSkinnedMesh=!0)),void 0!==nodeDef.camera&&this._addNodeRef(this.cameraCache,nodeDef.camera)}},GLTFParser.prototype._addNodeRef=function(cache,index){void 0!==index&&(void 0===cache.refs[index]&&(cache.refs[index]=cache.uses[index]=0),cache.refs[index]++)},GLTFParser.prototype._getNodeRef=function(cache,index,object){if(cache.refs[index]<=1)return object;var ref=object.clone();return ref.name+="_instance_"+cache.uses[index]++,ref},GLTFParser.prototype._invokeOne=function(func){var extensions=Object.values(this.plugins);extensions.push(this);for(var i=0;i<extensions.length;i++){var result=func(extensions[i]);if(result)return result}},GLTFParser.prototype._invokeAll=function(func){var extensions=Object.values(this.plugins);extensions.unshift(this);for(var pending=[],i=0;i<extensions.length;i++){var result=func(extensions[i]);result&&pending.push(result)}return pending},GLTFParser.prototype.getDependency=function(type,index){var cacheKey=type+":"+index,dependency=this.cache.get(cacheKey);if(!dependency){switch(type){case"scene":dependency=this.loadScene(index);break;case"node":dependency=this.loadNode(index);break;case"mesh":dependency=this._invokeOne((function(ext){return ext.loadMesh&&ext.loadMesh(index)}));break;case"accessor":dependency=this.loadAccessor(index);break;case"bufferView":dependency=this._invokeOne((function(ext){return ext.loadBufferView&&ext.loadBufferView(index)}));break;case"buffer":dependency=this.loadBuffer(index);break;case"material":dependency=this._invokeOne((function(ext){return ext.loadMaterial&&ext.loadMaterial(index)}));break;case"texture":dependency=this._invokeOne((function(ext){return ext.loadTexture&&ext.loadTexture(index)}));break;case"skin":dependency=this.loadSkin(index);break;case"animation":dependency=this.loadAnimation(index);break;case"camera":dependency=this.loadCamera(index);break;default:throw new Error("Unknown type: "+type)}this.cache.add(cacheKey,dependency)}return dependency},GLTFParser.prototype.getDependencies=function(type){var dependencies=this.cache.get(type);if(!dependencies){var parser=this,defs=this.json[type+("mesh"===type?"es":"s")]||[];dependencies=Promise.all(defs.map((function(def,index){return parser.getDependency(type,index)}))),this.cache.add(type,dependencies)}return dependencies},GLTFParser.prototype.loadBuffer=function(bufferIndex){var bufferDef=this.json.buffers[bufferIndex],loader=this.fileLoader;if(bufferDef.type&&"arraybuffer"!==bufferDef.type)throw new Error("THREE.GLTFLoader: "+bufferDef.type+" buffer type is not supported.");if(void 0===bufferDef.uri&&0===bufferIndex)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);var options=this.options;return new Promise((function(resolve,reject){loader.load(resolveURL(bufferDef.uri,options.path),resolve,void 0,(function(){reject(new Error('THREE.GLTFLoader: Failed to load buffer "'+bufferDef.uri+'".'))}))}))},GLTFParser.prototype.loadBufferView=function(bufferViewIndex){var bufferViewDef=this.json.bufferViews[bufferViewIndex];return this.getDependency("buffer",bufferViewDef.buffer).then((function(buffer){var byteLength=bufferViewDef.byteLength||0,byteOffset=bufferViewDef.byteOffset||0;return buffer.slice(byteOffset,byteOffset+byteLength)}))},GLTFParser.prototype.loadAccessor=function(accessorIndex){var parser=this,json=this.json,accessorDef=this.json.accessors[accessorIndex];if(void 0===accessorDef.bufferView&&void 0===accessorDef.sparse)return Promise.resolve(null);var pendingBufferViews=[];return void 0!==accessorDef.bufferView?pendingBufferViews.push(this.getDependency("bufferView",accessorDef.bufferView)):pendingBufferViews.push(null),void 0!==accessorDef.sparse&&(pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.indices.bufferView)),pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.values.bufferView))),Promise.all(pendingBufferViews).then((function(bufferViews){var bufferView=bufferViews[0],itemSize=WEBGL_TYPE_SIZES[accessorDef.type],TypedArray=WEBGL_COMPONENT_TYPES[accessorDef.componentType],elementBytes=TypedArray.BYTES_PER_ELEMENT,itemBytes=elementBytes*itemSize,byteOffset=accessorDef.byteOffset||0,byteStride=void 0!==accessorDef.bufferView?json.bufferViews[accessorDef.bufferView].byteStride:void 0,normalized=!0===accessorDef.normalized,array,bufferAttribute;if(byteStride&&byteStride!==itemBytes){var ibSlice=Math.floor(byteOffset/byteStride),ibCacheKey="InterleavedBuffer:"+accessorDef.bufferView+":"+accessorDef.componentType+":"+ibSlice+":"+accessorDef.count,ib=parser.cache.get(ibCacheKey);ib||(array=new TypedArray(bufferView,ibSlice*byteStride,accessorDef.count*byteStride/elementBytes),ib=new THREE.InterleavedBuffer(array,byteStride/elementBytes),parser.cache.add(ibCacheKey,ib)),bufferAttribute=new THREE.InterleavedBufferAttribute(ib,itemSize,byteOffset%byteStride/elementBytes,normalized)}else array=null===bufferView?new TypedArray(accessorDef.count*itemSize):new TypedArray(bufferView,byteOffset,accessorDef.count*itemSize),bufferAttribute=new THREE.BufferAttribute(array,itemSize,normalized);if(void 0!==accessorDef.sparse){var itemSizeIndices=WEBGL_TYPE_SIZES.SCALAR,TypedArrayIndices=WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType],byteOffsetIndices=accessorDef.sparse.indices.byteOffset||0,byteOffsetValues=accessorDef.sparse.values.byteOffset||0,sparseIndices=new TypedArrayIndices(bufferViews[1],byteOffsetIndices,accessorDef.sparse.count*itemSizeIndices),sparseValues=new TypedArray(bufferViews[2],byteOffsetValues,accessorDef.sparse.count*itemSize);null!==bufferView&&(bufferAttribute=new THREE.BufferAttribute(bufferAttribute.array.slice(),bufferAttribute.itemSize,bufferAttribute.normalized));for(var i=0,il=sparseIndices.length;i<il;i++){var index=sparseIndices[i];if(bufferAttribute.setX(index,sparseValues[i*itemSize]),itemSize>=2&&bufferAttribute.setY(index,sparseValues[i*itemSize+1]),itemSize>=3&&bufferAttribute.setZ(index,sparseValues[i*itemSize+2]),itemSize>=4&&bufferAttribute.setW(index,sparseValues[i*itemSize+3]),itemSize>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return bufferAttribute}))},GLTFParser.prototype.loadTexture=function(textureIndex){var json=this.json,options=this.options,textureDef=json.textures[textureIndex],source=json.images[textureDef.source],loader=this.textureLoader;if(source.uri){var handler=options.manager.getHandler(source.uri);null!==handler&&(loader=handler)}return this.loadTextureImage(textureIndex,source,loader)},GLTFParser.prototype.loadTextureImage=function(textureIndex,source,loader){var parser=this,json=this.json,options=this.options,textureDef=json.textures[textureIndex],URL=self.URL||self.webkitURL,sourceURI=source.uri,isObjectURL=!1,hasAlpha=!0;if("image/jpeg"===source.mimeType&&(hasAlpha=!1),void 0!==source.bufferView)sourceURI=parser.getDependency("bufferView",source.bufferView).then((function(bufferView){if("image/png"===source.mimeType){var colorType=new DataView(bufferView,25,1).getUint8(0,!1);hasAlpha=6===colorType||4===colorType||3===colorType}isObjectURL=!0;var blob=new Blob([bufferView],{type:source.mimeType});return sourceURI=URL.createObjectURL(blob)}));else if(void 0===source.uri)throw new Error("THREE.GLTFLoader: Image "+textureIndex+" is missing URI and bufferView");return Promise.resolve(sourceURI).then((function(sourceURI){return new Promise((function(resolve,reject){var onLoad=resolve;!0===loader.isImageBitmapLoader&&(onLoad=function(imageBitmap){resolve(new THREE.CanvasTexture(imageBitmap))}),loader.load(resolveURL(sourceURI,options.path),onLoad,void 0,reject)}))})).then((function(texture){!0===isObjectURL&&URL.revokeObjectURL(sourceURI),texture.flipY=!1,textureDef.name&&(texture.name=textureDef.name),hasAlpha||(texture.format=THREE.RGBFormat);var samplers,sampler=(json.samplers||{})[textureDef.sampler]||{};return texture.magFilter=WEBGL_FILTERS[sampler.magFilter]||THREE.LinearFilter,texture.minFilter=WEBGL_FILTERS[sampler.minFilter]||THREE.LinearMipmapLinearFilter,texture.wrapS=WEBGL_WRAPPINGS[sampler.wrapS]||THREE.RepeatWrapping,texture.wrapT=WEBGL_WRAPPINGS[sampler.wrapT]||THREE.RepeatWrapping,parser.associations.set(texture,{type:"textures",index:textureIndex}),texture}))},GLTFParser.prototype.assignTexture=function(materialParams,mapName,mapDef){var parser=this;return this.getDependency("texture",mapDef.index).then((function(texture){if(void 0===mapDef.texCoord||0==mapDef.texCoord||"aoMap"===mapName&&1==mapDef.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+mapDef.texCoord+" for texture "+mapName+" not yet supported."),parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){var transform=void 0!==mapDef.extensions?mapDef.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(transform){var gltfReference=parser.associations.get(texture);texture=parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(texture,transform),parser.associations.set(texture,gltfReference)}}materialParams[mapName]=texture}))},GLTFParser.prototype.assignFinalMaterial=function(mesh){var geometry=mesh.geometry,material=mesh.material,useVertexTangents=void 0!==geometry.attributes.tangent,useVertexColors=void 0!==geometry.attributes.color,useFlatShading=void 0===geometry.attributes.normal,useSkinning=!0===mesh.isSkinnedMesh,useMorphTargets=Object.keys(geometry.morphAttributes).length>0,useMorphNormals=useMorphTargets&&void 0!==geometry.morphAttributes.normal;if(mesh.isPoints){var cacheKey="PointsMaterial:"+material.uuid,pointsMaterial=this.cache.get(cacheKey);pointsMaterial||(pointsMaterial=new THREE.PointsMaterial,THREE.Material.prototype.copy.call(pointsMaterial,material),pointsMaterial.color.copy(material.color),pointsMaterial.map=material.map,pointsMaterial.sizeAttenuation=!1,this.cache.add(cacheKey,pointsMaterial)),material=pointsMaterial}else if(mesh.isLine){var cacheKey="LineBasicMaterial:"+material.uuid,lineMaterial=this.cache.get(cacheKey);lineMaterial||(lineMaterial=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(lineMaterial,material),lineMaterial.color.copy(material.color),this.cache.add(cacheKey,lineMaterial)),material=lineMaterial}if(useVertexTangents||useVertexColors||useFlatShading||useSkinning||useMorphTargets){var cacheKey="ClonedMaterial:"+material.uuid+":";material.isGLTFSpecularGlossinessMaterial&&(cacheKey+="specular-glossiness:"),useSkinning&&(cacheKey+="skinning:"),useVertexTangents&&(cacheKey+="vertex-tangents:"),useVertexColors&&(cacheKey+="vertex-colors:"),useFlatShading&&(cacheKey+="flat-shading:"),useMorphTargets&&(cacheKey+="morph-targets:"),useMorphNormals&&(cacheKey+="morph-normals:");var cachedMaterial=this.cache.get(cacheKey);cachedMaterial||(cachedMaterial=material.clone(),useSkinning&&(cachedMaterial.skinning=!0),useVertexColors&&(cachedMaterial.vertexColors=!0),useFlatShading&&(cachedMaterial.flatShading=!0),useMorphTargets&&(cachedMaterial.morphTargets=!0),useMorphNormals&&(cachedMaterial.morphNormals=!0),useVertexTangents&&(cachedMaterial.vertexTangents=!0,cachedMaterial.normalScale&&(cachedMaterial.normalScale.y*=-1),cachedMaterial.clearcoatNormalScale&&(cachedMaterial.clearcoatNormalScale.y*=-1)),this.cache.add(cacheKey,cachedMaterial),this.associations.set(cachedMaterial,this.associations.get(material))),material=cachedMaterial}material.aoMap&&void 0===geometry.attributes.uv2&&void 0!==geometry.attributes.uv&&geometry.setAttribute("uv2",geometry.attributes.uv),mesh.material=material},GLTFParser.prototype.getMaterialType=function(){return THREE.MeshStandardMaterial},GLTFParser.prototype.loadMaterial=function(materialIndex){var parser=this,json=this.json,extensions=this.extensions,materialDef=json.materials[materialIndex],materialType,materialParams={},materialExtensions=materialDef.extensions||{},pending=[];if(materialExtensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var sgExtension=extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];materialType=sgExtension.getMaterialType(),pending.push(sgExtension.extendParams(materialParams,materialDef,parser))}else if(materialExtensions[EXTENSIONS.KHR_MATERIALS_UNLIT]){var kmuExtension=extensions[EXTENSIONS.KHR_MATERIALS_UNLIT];materialType=kmuExtension.getMaterialType(),pending.push(kmuExtension.extendParams(materialParams,materialDef,parser))}else{var metallicRoughness=materialDef.pbrMetallicRoughness||{};if(materialParams.color=new THREE.Color(1,1,1),materialParams.opacity=1,Array.isArray(metallicRoughness.baseColorFactor)){var array=metallicRoughness.baseColorFactor;materialParams.color.fromArray(array),materialParams.opacity=array[3]}void 0!==metallicRoughness.baseColorTexture&&pending.push(parser.assignTexture(materialParams,"map",metallicRoughness.baseColorTexture)),materialParams.metalness=void 0!==metallicRoughness.metallicFactor?metallicRoughness.metallicFactor:1,materialParams.roughness=void 0!==metallicRoughness.roughnessFactor?metallicRoughness.roughnessFactor:1,void 0!==metallicRoughness.metallicRoughnessTexture&&(pending.push(parser.assignTexture(materialParams,"metalnessMap",metallicRoughness.metallicRoughnessTexture)),pending.push(parser.assignTexture(materialParams,"roughnessMap",metallicRoughness.metallicRoughnessTexture))),materialType=this._invokeOne((function(ext){return ext.getMaterialType&&ext.getMaterialType(materialIndex)})),pending.push(Promise.all(this._invokeAll((function(ext){return ext.extendMaterialParams&&ext.extendMaterialParams(materialIndex,materialParams)}))))}!0===materialDef.doubleSided&&(materialParams.side=THREE.DoubleSide);var alphaMode=materialDef.alphaMode||ALPHA_MODES_OPAQUE;return alphaMode===ALPHA_MODES_BLEND?(materialParams.transparent=!0,materialParams.depthWrite=!1):(materialParams.transparent=!1,alphaMode===ALPHA_MODES_MASK&&(materialParams.alphaTest=void 0!==materialDef.alphaCutoff?materialDef.alphaCutoff:.5)),void 0!==materialDef.normalTexture&&materialType!==THREE.MeshBasicMaterial&&(pending.push(parser.assignTexture(materialParams,"normalMap",materialDef.normalTexture)),materialParams.normalScale=new THREE.Vector2(1,-1),void 0!==materialDef.normalTexture.scale&&materialParams.normalScale.set(materialDef.normalTexture.scale,-materialDef.normalTexture.scale)),void 0!==materialDef.occlusionTexture&&materialType!==THREE.MeshBasicMaterial&&(pending.push(parser.assignTexture(materialParams,"aoMap",materialDef.occlusionTexture)),void 0!==materialDef.occlusionTexture.strength&&(materialParams.aoMapIntensity=materialDef.occlusionTexture.strength)),void 0!==materialDef.emissiveFactor&&materialType!==THREE.MeshBasicMaterial&&(materialParams.emissive=(new THREE.Color).fromArray(materialDef.emissiveFactor)),void 0!==materialDef.emissiveTexture&&materialType!==THREE.MeshBasicMaterial&&pending.push(parser.assignTexture(materialParams,"emissiveMap",materialDef.emissiveTexture)),Promise.all(pending).then((function(){var material;return material=materialType===GLTFMeshStandardSGMaterial?extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(materialParams):new materialType(materialParams),materialDef.name&&(material.name=materialDef.name),material.map&&(material.map.encoding=THREE.sRGBEncoding),material.emissiveMap&&(material.emissiveMap.encoding=THREE.sRGBEncoding),assignExtrasToUserData(material,materialDef),parser.associations.set(material,{type:"materials",index:materialIndex}),materialDef.extensions&&addUnknownExtensionsToUserData(extensions,material,materialDef),material}))},GLTFParser.prototype.createUniqueName=function(originalName){for(var sanitizedName=THREE.PropertyBinding.sanitizeNodeName(originalName||""),name=sanitizedName,i=1;this.nodeNamesUsed[name];++i)name=sanitizedName+"_"+i;return this.nodeNamesUsed[name]=!0,name},GLTFParser.prototype.loadGeometries=function(primitives){var parser=this,extensions=this.extensions,cache=this.primitiveCache;function createDracoPrimitive(primitive){return extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(primitive,parser).then((function(geometry){return addPrimitiveAttributes(geometry,primitive,parser)}))}for(var pending=[],i=0,il=primitives.length;i<il;i++){var primitive=primitives[i],cacheKey=createPrimitiveKey(primitive),cached=cache[cacheKey],geometryPromise;if(cached)pending.push(cached.promise);else geometryPromise=primitive.extensions&&primitive.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?createDracoPrimitive(primitive):addPrimitiveAttributes(new THREE.BufferGeometry,primitive,parser),cache[cacheKey]={primitive:primitive,promise:geometryPromise},pending.push(geometryPromise)}return Promise.all(pending)},GLTFParser.prototype.loadMesh=function(meshIndex){for(var parser=this,json=this.json,extensions=this.extensions,meshDef=json.meshes[meshIndex],primitives=meshDef.primitives,pending=[],i=0,il=primitives.length;i<il;i++){var material=void 0===primitives[i].material?createDefaultMaterial(this.cache):this.getDependency("material",primitives[i].material);pending.push(material)}return pending.push(parser.loadGeometries(primitives)),Promise.all(pending).then((function(results){for(var materials=results.slice(0,results.length-1),geometries=results[results.length-1],meshes=[],i=0,il=geometries.length;i<il;i++){var geometry=geometries[i],primitive=primitives[i],mesh,material=materials[i];if(primitive.mode===WEBGL_CONSTANTS_TRIANGLES||primitive.mode===WEBGL_CONSTANTS_TRIANGLE_STRIP||primitive.mode===WEBGL_CONSTANTS_TRIANGLE_FAN||void 0===primitive.mode)!0!==(mesh=!0===meshDef.isSkinnedMesh?new THREE.SkinnedMesh(geometry,material):new THREE.Mesh(geometry,material)).isSkinnedMesh||mesh.geometry.attributes.skinWeight.normalized||mesh.normalizeSkinWeights(),primitive.mode===WEBGL_CONSTANTS_TRIANGLE_STRIP?mesh.geometry=toTrianglesDrawMode(mesh.geometry,THREE.TriangleStripDrawMode):primitive.mode===WEBGL_CONSTANTS_TRIANGLE_FAN&&(mesh.geometry=toTrianglesDrawMode(mesh.geometry,THREE.TriangleFanDrawMode));else if(primitive.mode===WEBGL_CONSTANTS_LINES)mesh=new THREE.LineSegments(geometry,material);else if(primitive.mode===WEBGL_CONSTANTS_LINE_STRIP)mesh=new THREE.Line(geometry,material);else if(primitive.mode===WEBGL_CONSTANTS_LINE_LOOP)mesh=new THREE.LineLoop(geometry,material);else{if(primitive.mode!==WEBGL_CONSTANTS_POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+primitive.mode);mesh=new THREE.Points(geometry,material)}Object.keys(mesh.geometry.morphAttributes).length>0&&updateMorphTargets(mesh,meshDef),mesh.name=parser.createUniqueName(meshDef.name||"mesh_"+meshIndex),assignExtrasToUserData(mesh,meshDef),primitive.extensions&&addUnknownExtensionsToUserData(extensions,mesh,primitive),parser.assignFinalMaterial(mesh),meshes.push(mesh)}if(1===meshes.length)return meshes[0];for(var group=new THREE.Group,i=0,il=meshes.length;i<il;i++)group.add(meshes[i]);return group}))},GLTFParser.prototype.loadCamera=function(cameraIndex){var camera,cameraDef=this.json.cameras[cameraIndex],params=cameraDef[cameraDef.type];if(params)return"perspective"===cameraDef.type?camera=new THREE.PerspectiveCamera(THREE.MathUtils.radToDeg(params.yfov),params.aspectRatio||1,params.znear||1,params.zfar||2e6):"orthographic"===cameraDef.type&&(camera=new THREE.OrthographicCamera(-params.xmag,params.xmag,params.ymag,-params.ymag,params.znear,params.zfar)),cameraDef.name&&(camera.name=this.createUniqueName(cameraDef.name)),assignExtrasToUserData(camera,cameraDef),Promise.resolve(camera);console.warn("THREE.GLTFLoader: Missing camera parameters.")},GLTFParser.prototype.loadSkin=function(skinIndex){var skinDef=this.json.skins[skinIndex],skinEntry={joints:skinDef.joints};return void 0===skinDef.inverseBindMatrices?Promise.resolve(skinEntry):this.getDependency("accessor",skinDef.inverseBindMatrices).then((function(accessor){return skinEntry.inverseBindMatrices=accessor,skinEntry}))},GLTFParser.prototype.loadAnimation=function(animationIndex){for(var json,animationDef=this.json.animations[animationIndex],pendingNodes=[],pendingInputAccessors=[],pendingOutputAccessors=[],pendingSamplers=[],pendingTargets=[],i=0,il=animationDef.channels.length;i<il;i++){var channel=animationDef.channels[i],sampler=animationDef.samplers[channel.sampler],target=channel.target,name=void 0!==target.node?target.node:target.id,input=void 0!==animationDef.parameters?animationDef.parameters[sampler.input]:sampler.input,output=void 0!==animationDef.parameters?animationDef.parameters[sampler.output]:sampler.output;pendingNodes.push(this.getDependency("node",name)),pendingInputAccessors.push(this.getDependency("accessor",input)),pendingOutputAccessors.push(this.getDependency("accessor",output)),pendingSamplers.push(sampler),pendingTargets.push(target)}return Promise.all([Promise.all(pendingNodes),Promise.all(pendingInputAccessors),Promise.all(pendingOutputAccessors),Promise.all(pendingSamplers),Promise.all(pendingTargets)]).then((function(dependencies){for(var nodes=dependencies[0],inputAccessors=dependencies[1],outputAccessors=dependencies[2],samplers=dependencies[3],targets=dependencies[4],tracks=[],i=0,il=nodes.length;i<il;i++){var node=nodes[i],inputAccessor=inputAccessors[i],outputAccessor=outputAccessors[i],sampler=samplers[i],target=targets[i];if(void 0!==node){var TypedKeyframeTrack;switch(node.updateMatrix(),node.matrixAutoUpdate=!0,PATH_PROPERTIES[target.path]){case PATH_PROPERTIES.weights:TypedKeyframeTrack=THREE.NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:TypedKeyframeTrack=THREE.QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:default:TypedKeyframeTrack=THREE.VectorKeyframeTrack}var targetName=node.name?node.name:node.uuid,interpolation=void 0!==sampler.interpolation?INTERPOLATION[sampler.interpolation]:THREE.InterpolateLinear,targetNames=[];PATH_PROPERTIES[target.path]===PATH_PROPERTIES.weights?node.traverse((function(object){!0===object.isMesh&&object.morphTargetInfluences&&targetNames.push(object.name?object.name:object.uuid)})):targetNames.push(targetName);var outputArray=outputAccessor.array;if(outputAccessor.normalized){var scale;if(outputArray.constructor===Int8Array)scale=1/127;else if(outputArray.constructor===Uint8Array)scale=1/255;else if(outputArray.constructor==Int16Array)scale=1/32767;else{if(outputArray.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");scale=1/65535}for(var scaled=new Float32Array(outputArray.length),j=0,jl=outputArray.length;j<jl;j++)scaled[j]=outputArray[j]*scale;outputArray=scaled}for(var j=0,jl=targetNames.length;j<jl;j++){var track=new TypedKeyframeTrack(targetNames[j]+"."+PATH_PROPERTIES[target.path],inputAccessor.array,outputArray,interpolation);"CUBICSPLINE"===sampler.interpolation&&(track.createInterpolant=function InterpolantFactoryMethodGLTFCubicSpline(result){return new GLTFCubicSplineInterpolant(this.times,this.values,this.getValueSize()/3,result)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),tracks.push(track)}}}var name=animationDef.name?animationDef.name:"animation_"+animationIndex;return new THREE.AnimationClip(name,void 0,tracks)}))},GLTFParser.prototype.loadNode=function(nodeIndex){var json=this.json,extensions=this.extensions,parser=this,nodeDef=json.nodes[nodeIndex],nodeName=nodeDef.name?parser.createUniqueName(nodeDef.name):"",pending;return(pending=[],void 0!==nodeDef.mesh&&pending.push(parser.getDependency("mesh",nodeDef.mesh).then((function(mesh){var node=parser._getNodeRef(parser.meshCache,nodeDef.mesh,mesh);return void 0!==nodeDef.weights&&node.traverse((function(o){if(o.isMesh)for(var i=0,il=nodeDef.weights.length;i<il;i++)o.morphTargetInfluences[i]=nodeDef.weights[i]})),node}))),void 0!==nodeDef.camera&&pending.push(parser.getDependency("camera",nodeDef.camera).then((function(camera){return parser._getNodeRef(parser.cameraCache,nodeDef.camera,camera)}))),parser._invokeAll((function(ext){return ext.createNodeAttachment&&ext.createNodeAttachment(nodeIndex)})).forEach((function(promise){pending.push(promise)})),Promise.all(pending)).then((function(objects){var node;if((node=!0===nodeDef.isBone?new THREE.Bone:objects.length>1?new THREE.Group:1===objects.length?objects[0]:new THREE.Object3D)!==objects[0])for(var i=0,il=objects.length;i<il;i++)node.add(objects[i]);if(nodeDef.name&&(node.userData.name=nodeDef.name,node.name=nodeName),assignExtrasToUserData(node,nodeDef),nodeDef.extensions&&addUnknownExtensionsToUserData(extensions,node,nodeDef),void 0!==nodeDef.matrix){var matrix=new THREE.Matrix4;matrix.fromArray(nodeDef.matrix),node.applyMatrix4(matrix)}else void 0!==nodeDef.translation&&node.position.fromArray(nodeDef.translation),void 0!==nodeDef.rotation&&node.quaternion.fromArray(nodeDef.rotation),void 0!==nodeDef.scale&&node.scale.fromArray(nodeDef.scale);return parser.associations.set(node,{type:"nodes",index:nodeIndex}),node}))},GLTFParser.prototype.loadScene=function(){function buildNodeHierachy(nodeId,parentObject,json,parser){var nodeDef=json.nodes[nodeId];return parser.getDependency("node",nodeId).then((function(node){return void 0===nodeDef.skin?node:parser.getDependency("skin",nodeDef.skin).then((function(skin){for(var pendingJoints=[],i=0,il=(skinEntry=skin).joints.length;i<il;i++)pendingJoints.push(parser.getDependency("node",skinEntry.joints[i]));return Promise.all(pendingJoints)})).then((function(jointNodes){return node.traverse((function(mesh){if(mesh.isMesh){for(var bones=[],boneInverses=[],j=0,jl=jointNodes.length;j<jl;j++){var jointNode=jointNodes[j];if(jointNode){bones.push(jointNode);var mat=new THREE.Matrix4;void 0!==skinEntry.inverseBindMatrices&&mat.fromArray(skinEntry.inverseBindMatrices.array,16*j),boneInverses.push(mat)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',skinEntry.joints[j])}mesh.bind(new THREE.Skeleton(bones,boneInverses),mesh.matrixWorld)}})),node}));var skinEntry})).then((function(node){parentObject.add(node);var pending=[];if(nodeDef.children)for(var children=nodeDef.children,i=0,il=children.length;i<il;i++){var child=children[i];pending.push(buildNodeHierachy(child,node,json,parser))}return Promise.all(pending)}))}return function loadScene(sceneIndex){var json=this.json,extensions=this.extensions,sceneDef=this.json.scenes[sceneIndex],parser=this,scene=new THREE.Group;sceneDef.name&&(scene.name=this.createUniqueName(sceneDef.name)),assignExtrasToUserData(scene,sceneDef),sceneDef.extensions&&addUnknownExtensionsToUserData(extensions,scene,sceneDef);for(var nodeIds=sceneDef.nodes||[],pending=[],i=0,il=nodeIds.length;i<il;i++)pending.push(buildNodeHierachy(nodeIds[i],scene,json,this));return Promise.all(pending).then((function(){return scene}))}}(),GLTFLoader}();